name: "Deploy"

run-name: ${{ github.actor }} invoked Terraform & Ansible jobs

on:
  push:
    branches: [test-ci]
    # paths-ignore:
    #   - "**/README.md"
    #   - "**/LICENSE"
    #   - ".github/workflows/**"
    #   - "Diagram/**"

env:
  TF_CLOUD_ORGANIZATION: "${{ secrets.TF_CLOUD_ORGANIZATION }}"
  TF_API_TOKEN: "${{ secrets.TF_API_TOKEN }}"
  TF_WORKSPACE: "${{ secrets.TF_WORKSPACE }}"
  # Terraform config path to the root module on the repo
  CONFIG_DIRECTORY: "./"

jobs:
  deploy:
    name: "Deploy"
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: "Install AWS CLI"
        uses: unfor19/install-aws-cli-action@v1

      - name: "Run AWS CLI version"
        run: aws --version
      
      - name: "Configure AWS Credentials"
        run: aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }} && aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }} && aws configure set default.region "us-east-1"

      - name: "Cat AWS Config"
        run: cat ~/.aws/config